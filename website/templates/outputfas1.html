<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECT PROGRESS TRACKER</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --card-bg: #ffffff;
            --border-color: #dee2e6;
            --header-bg: #f8f9fa;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --table-stripe: #f9f9f9;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --card-bg: #2d2d2d;
            --border-color: #404040;
            --header-bg: #333333;
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
            --table-stripe: #363636;
        }

        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            color: var(--text-color);
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .print-btn {
            position: fixed;
            top: 20px;
            right: 140px;
            z-index: 1000;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .print-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        h1, h2, h3, h6 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .container {
            margin: auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-top: 60px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: center;
            font-size: 14px;
        }

        th {
            background-color: var(--header-bg);
            font-weight: 600;
            color: var(--text-color);
        }

        tr:nth-child(even) {
            background-color: var(--table-stripe);
        }

        .table-cablework td {
            background-color: #dc3545;
            color: white;
        }

        .table-devicework td {
            background-color: #28a745;
            color: white;
        }

        .table-panel-room-works td {
            background-color: #fd7e14;
            color: white;
        }

        .table-commissioning-works td {
            background-color: #6f42c1;
            color: white;
        }

        .table-other-works td {
            background-color: #ff6b6b;
            color: white;
        }

        .progress {
            height: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--border-color);
        }

        .progress-bar {
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 0.6s ease;
        }

        .logo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .lines {
            margin: 20px 0;
        }

        .line {
            height: 6px;
            margin-bottom: 3px;
            border-radius: 3px;
        }

        .line1 {
            background: linear-gradient(to right, #28a745, #ffc107, #28a745);
        }

        .line2 {
            background: linear-gradient(to right, #dc3545, #8b0000);
        }

        .line3 {
            background: linear-gradient(to right, #007bff, #87ceeb, #007bff);
        }

        .footer {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-top: 2px solid var(--border-color);
            margin-top: 40px;
        }

        .contact-info {
            margin-bottom: 10px;
        }

        .left, .right {
            flex: 1;
        }

        .left {
            margin-right: 20px;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .status-not-approved {
            background-color: #dc3545 !important;
            color: white;
        }

        .status-pending {
            background-color: #ffc107 !important;
            color: #212529;
        }

        .status-done {
            background-color: #28a745 !important;
            color: white;
        }

        .status-completed {
            background-color: #28a745 !important;
            color: white;
        }

        .highlight-row {
            background-color: #fd7e14 !important;
            color: white;
        }

        .watermark {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: url('/static/logo.png');
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
        }

        @media print {
            .theme-toggle, .print-btn {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .container {
                box-shadow: none !important;
                margin-top: 0 !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin-top: 80px;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .print-btn {
                top: 10px;
                right: 120px;
                padding: 8px 16px;
                font-size: 12px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="watermark"></div>
    
    <button class="theme-toggle" onclick="toggleTheme()">
        <i class="fa fa-moon-o" id="theme-icon"></i>
        <span id="theme-text">Dark</span>
    </button>
    
    <button class="print-btn" onclick="generatePDF()">
        <i class="fa fa-file-pdf-o"></i>
        <span>Export PDF</span>
    </button>

    <div class="container" id="report-content">
        <div class="logo-header">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" width="100">
            <h3><strong>Nadiya Technology Solutions Pvt Ltd</strong></h3>
        </div>
        
        <div class="lines">
            <div class="line line1"></div>
            <div class="line line2"></div>
            <div class="line line3"></div>
        </div>
        
        <div class="header">
            <h1><strong>PROJECT PROGRESS TRACKER</strong></h1>
        </div>

        <div class="row">
            <div class="col-md-6 text-left">
                <p><strong>CUSTOMER NAME:</strong> {{current_user.email}}</p>
                {%if infos %}
                <p><strong>LOCATION:</strong> {{infos[-1].loc}}</p>
                <p><strong>PO. NUMBER:</strong> {{infos[-1].po}}</p>
                <p><strong>PO. Date:</strong> {{infos[-1].pon}}</p>
                {%endif%}
                <p><strong>START DATE:</strong> {{planned.start}}</p>
            </div>
            <div class="col-md-6 text-right">
                <p><strong>REPORT DATE:</strong> {{ current_date }}</p>
            </div>
        </div>

        <!-- Cable Work Table -->
        <div style="overflow-x: auto; margin-top: 30px;">
            <table>
                <thead class="table-cablework">
                    <tr>
                        <td colspan="4"><strong>CABLE WORK</strong></td>
                    </tr>
                    <tr>
                        <th>Work Type</th>
                        <th>Total Project Quantity</th>
                        <th>Actual</th>
                        <th>Actual %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Cable Tray in meters</th>
                        <td>{{planned.cable_planned}}</td>
                        <td>{{cable_actual}}</td>
                        <td>
                            {% set cable_percentage = ((cable_actual / planned.cable_planned) * 100)| round(2) %}
                            {{ cable_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>PVC Conduit (FRLS) installation in meters</th>
                        <td>{{planned.pvc_planned}}</td>
                        <td>{{ pvc_actual }}</td>
                        <td>
                            {% set pvc_percentage = ((pvc_actual / planned.pvc_planned) * 100)| round(2) %}
                            {{ pvc_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Marking and Drilling work in meters</th>
                        <td>{{planned.mark_planned}}</td>
                        <td>{{ mark_actual }}</td>
                        <td>
                            {% set mark_percentage = ((mark_actual / planned.mark_planned) * 100) | round(2) %}
                            {{ mark_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Cable installation in meters</th>
                        <td>{{planned.ci_planned}}</td>
                        <td>{{ ci_actual }}</td>
                        <td>
                            {% set ci_percentage = ((ci_actual / planned.ci_planned) * 100) | round(2) %}
                            {{ ci_percentage }}%
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="progress">
                {% set total_actual = cable_actual*6 + pvc_actual*4 + mark_actual*30+ ci_actual*60 %}
                {% set total_planned = planned.cable_planned*6 + planned.pvc_planned*4 +planned.mark_planned*30+planned.ci_planned*60 %}
                {% set total_percentage = ((total_actual / total_planned) * 100)|round(2) %}
                <div class="progress-bar" style="width: {{ total_percentage }}%; background-color: #dc3545;">{{ total_percentage }}%</div>
            </div>
        </div>

        <!-- Device Work Table -->
        <div style="overflow-x: auto; margin-top: 30px;">
            <table>
                <thead class="table-devicework">
                    <tr>
                        <td colspan="4"><strong>DEVICE WORK</strong></td>
                    </tr>
                    <tr>
                        <th>Device Type</th>
                        <th>Total Project Quantity</th>
                        <th>Actual</th>
                        <th>Actual %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Backbox installation</th>
                        <td>{{ planned.backboxinstallation_planned }}</td>
                        <td>{{ backboxinstallation_actual }}</td>
                        <td>
                            {% set backboxinstallation_percentage = ((backboxinstallation_actual / planned.backboxinstallation_planned) * 100)| round(2) %}
                            {{ backboxinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Base installation</th>
                        <td>{{planned.baseinstallation_planned}}</td>
                        <td>{{ baseinstallation_actual }}</td>
                        <td>
                            {% set baseinstallation_percentage = ((baseinstallation_actual / planned.baseinstallation_planned) * 100)| round(2) %}
                            {{ baseinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Detector installation</th>
                        <td>{{planned.detectorinstallation_planned}}</td>
                        <td>{{ detectorinstallation_actual }}</td>
                        <td>
                            {% set detectorinstallation_percentage = ((detectorinstallation_actual / planned.detectorinstallation_planned) * 100)| round(2) %}
                            {{ detectorinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Control Module installation</th>
                        <td>{{planned.controlmoduleinstallation_planned}}</td>
                        <td>{{ controlmoduleinstallation_actual }}</td>
                        <td>
                            {% set controlmoduleinstallation_percentage = ((controlmoduleinstallation_actual / planned.controlmoduleinstallation_planned) * 100)| round(2) %}
                            {{ controlmoduleinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Hooter installation</th>
                        <td>{{planned.hooterinstallation_planned}}</td>
                        <td>{{ hooterinstallation_actual }}</td>
                        <td>
                            {% set hooterinstallation_percentage = ((hooterinstallation_actual / planned.hooterinstallation_planned) * 100)| round(2) %}
                            {{ hooterinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>MCP installation</th>
                        <td>{{planned.mcpinstallation_planned}}</td>
                        <td>{{ mcpinstallation_actual }}</td>
                        <td>
                            {% set mcpinstallation_percentage = ((mcpinstallation_actual / planned.mcpinstallation_planned) * 100)| round(2) %}
                            {{ mcpinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Response Indicator installation</th>
                        <td>{{planned.responseindicatorinstallation_planned}}</td>
                        <td>{{ responseindicatorinstallation_actual }}</td>
                        <td>
                            {% set responseindicatorinstallation_percentage = ((responseindicatorinstallation_actual / planned.responseindicatorinstallation_planned) * 100)| round(2) %}
                            {{ responseindicatorinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Monitor Module installation</th>
                        <td>{{planned.monitormoduleinstallation_planned}}</td>
                        <td>{{ monitormoduleinstallation_actual }}</td>
                        <td>
                            {% set monitormoduleinstallation_percentage = ((monitormoduleinstallation_actual / planned.monitormoduleinstallation_planned) * 100)| round(2) %}
                            {{ monitormoduleinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Control Relay Module installation</th>
                        <td>{{planned.controlrelaymoduleinstallation_planned}}</td>
                        <td>{{ controlrelaymoduleinstallation_actual }}</td>
                        <td>
                            {% set controlrelaymoduleinstallation_percentage = ((controlrelaymoduleinstallation_actual / planned.controlrelaymoduleinstallation_planned) * 100)| round(2) %}
                            {{ controlrelaymoduleinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Isolator Module installation</th>
                        <td>{{planned.isolatormoduleinstallation_planned}}</td>
                        <td>{{ isolatormoduleinstallation_actual }}</td>
                        <td>
                            {% set isolatormoduleinstallation_percentage = ((isolatormoduleinstallation_actual / planned.isolatormoduleinstallation_planned) * 100)| round(2) %}
                            {{ isolatormoduleinstallation_percentage }}%
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="progress">
                {% set total_actual_device = backboxinstallation_actual*20 + baseinstallation_actual*26.7 + detectorinstallation_actual*10 + controlmoduleinstallation_actual*6.7 + hooterinstallation_actual*6.7 + mcpinstallation_actual*6.7 + responseindicatorinstallation_actual*6.7 + monitormoduleinstallation_actual*6.7 + controlrelaymoduleinstallation_actual*6.7 + isolatormoduleinstallation_actual*3.3 %}
                {% set total_planned_device = planned.backboxinstallation_planned*20 + planned.baseinstallation_planned*26.7 + planned.detectorinstallation_planned*10 + planned.controlmoduleinstallation_planned*6.7 + planned.hooterinstallation_planned*6.7 + planned.mcpinstallation_planned*6.7 + planned.responseindicatorinstallation_planned*6.7+ planned.monitormoduleinstallation_planned*6.7 + planned.controlrelaymoduleinstallation_planned*6.7 + planned.isolatormoduleinstallation_planned*3.3 %}
                {% set total_percentage_device = ((total_actual_device / total_planned_device) * 100)|round(2) %}
                <div class="progress-bar" style="width: {{ total_percentage_device }}%; background-color: #28a745;">{{ total_percentage_device }}%</div>
            </div>
        </div>

        <!-- Panel Room Works Table -->
        <div style="overflow-x: auto; margin-top: 30px;">
            <table>
                <thead class="table-panel-room-works">
                    <tr>
                        <td colspan="4"><strong>PANEL ROOM WORKS</strong></td>
                    </tr>
                    <tr>
                        <th>Work Type</th>
                        <th>Total Project Quantity</th>
                        <th>Actual</th>
                        <th>Actual %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Fire Panel installation</th>
                        <td>{{planned.firepanelinstallation_planned}}</td>
                        <td>{{ firepanelinstallation_actual }}</td>
                        <td>
                            {% set firepanelinstallation_percentage = ((firepanelinstallation_actual / planned.firepanelinstallation_planned) * 100)| round(2) %}
                            {{ firepanelinstallation_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>SMPS installation</th>
                        <td>{{planned.smpsinstallation_planned}}</td>
                        <td>{{ smpsinstallation_actual }}</td>
                        <td>
                            {% set smpsinstallation_percentage = ((smpsinstallation_actual / planned.smpsinstallation_planned) * 100)| round(2) %}
                            {{ smpsinstallation_percentage }}%
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="progress">
                {% set total_actual_panel_room = firepanelinstallation_actual*66.66 +smpsinstallation_actual*33.33 %}
                {% set total_planned_panel_room = planned.firepanelinstallation_planned*66.66 + planned.smpsinstallation_planned*33.33%}
                {% set total_percentage_panel_room = ((total_actual_panel_room / total_planned_panel_room) * 100) | round(2) %}
                <div class="progress-bar" style="width: {{ total_percentage_panel_room }}%; background-color: #fd7e14;">{{ total_percentage_panel_room }}%</div>
            </div>
        </div>

        <!-- Commissioning Works Table -->
        <div style="overflow-x: auto; margin-top: 30px;">
            <table>
                <thead class="table-commissioning-works">
                    <tr>
                        <td colspan="4"><strong>COMMISSIONING WORKS</strong></td>
                    </tr>
                    <tr>
                        <th>Work Type</th>
                        <th>Total Project Quantity</th>
                        <th>Actual</th>
                        <th>Actual %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Detector testing</th>
                        <td>{{planned.detectortesting_planned}}</td>
                        <td>{{ detectortesting_actual }}</td>
                        <td>
                            {% set detectortesting_percentage = ((detectortesting_actual / planned.detectortesting_planned) * 100)| round(2) %}
                            {{ detectortesting_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Continuity testing</th>
                        <td>{{planned.continuitytesting_planned}}</td>
                        <td>{{ continuitytesting_actual }}</td>
                        <td>
                            {% set continuitytesting_percentage = ((continuitytesting_actual / planned.continuitytesting_planned) * 100)| round(2) %}
                            {{ continuitytesting_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Programming</th>
                        <td>{{planned.programming_planned}}</td>
                        <td>{{ programming_actual }}</td>
                        <td>
                            {% set programming_percentage = ((programming_actual / planned.programming_planned) * 100)| round(2) %}
                            {{ programming_percentage }}%
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="progress">
                {% set total_actual_commissioning = detectortesting_actual*33.33 + continuitytesting_actual*33.33 + programming_actual*33.33 %}
                {% set total_planned_commissioning = planned.detectortesting_planned*33.33 + planned.continuitytesting_planned*33.33 + planned.programming_planned*33.33 %}
                {% set total_percentage_commissioning = ((total_actual_commissioning / total_planned_commissioning) * 100) | round(2) %}
                <div class="progress-bar" style="width: {{ total_percentage_commissioning }}%; background-color: #6f42c1;">{{ total_percentage_commissioning }}%</div>
            </div>
        </div>

        <!-- Other Works Table -->
        <div style="overflow-x: auto; margin-top: 30px;">
            <table>
                <thead class="table-other-works">
                    <tr>
                        <td colspan="4"><strong>OTHER WORKS</strong></td>
                    </tr>
                    <tr>
                        <th>Work Type</th>
                        <th>Total Project Quantity</th>
                        <th>Actual</th>
                        <th>Actual %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Chipping/Plastering work</th>
                        <td>{{planned.chippingplasting_planned}}</td>
                        <td>{{ chippingplasting_actual }}</td>
                        <td>
                            {% set chippingplasting_percentage = ((chippingplasting_actual / planned.chippingplasting_planned) * 100)| round(2) %}
                            {{ chippingplasting_percentage }}%
                        </td>
                    </tr>
                    <tr>
                        <th>Handing over document</th>
                        <td>{{planned.handingoverdocument_planned}}</td>
                        <td>{{ handingoverdocument_actual }}</td>
                        <td>
                            {% set handingoverdocument_percentage = ((handingoverdocument_actual / planned.handingoverdocument_planned) * 100)| round(2) %}
                            {{ handingoverdocument_percentage }}%
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="progress">
                {% set total_actual_other = chippingplasting_actual*80 + handingoverdocument_actual*20 %}
                {% set total_planned_other = planned.chippingplasting_planned*80 + planned.handingoverdocument_planned*20 %}
                {% set total_percentage_other = ((total_actual_other / total_planned_other) * 100) | round(2) %}
                <div class="progress-bar" style="width: {{ total_percentage_other }}%; background-color: #ff6b6b;">{{ total_percentage_other }}%</div>
            </div>
        </div>

        <!-- Project Completion -->
        <div style="border: 4px solid #007bff; padding: 20px; margin: 40px 0; border-radius: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
            <h2><strong>PROJECT COMPLETION</strong></h2>
            <h3><strong>Total Percentage = 
                {% set total_percentage = (cable_percentage*3 + pvc_percentage*2 + mark_percentage*15 + ci_percentage*30 +backboxinstallation_percentage*6 + baseinstallation_percentage*8 +detectorinstallation_percentage*3+controlmoduleinstallation_percentage*2+hooterinstallation_percentage*2+mcpinstallation_percentage*2+responseindicatorinstallation_percentage*2+monitormoduleinstallation_percentage*2+ controlrelaymoduleinstallation_percentage*2+ isolatormoduleinstallation_percentage*1+ firepanelinstallation_percentage*2 +smpsinstallation_percentage*1+detectortesting_percentage*4 +continuitytesting_percentage*4+ programming_percentage*4+chippingplasting_percentage*4+ handingoverdocument_percentage*1)/100 %}
                {% set total_percentage = total_percentage | round(2) %}
                {{ total_percentage }}%
            </strong></h3>
            <div class="progress" style="height: 40px;">
                <div class="progress-bar" style="width: {{ total_percentage }}%; background: linear-gradient(45deg, #28a745, #20c997); font-size: 18px; font-weight: bold;">{{ total_percentage }}%</div>
            </div>
        </div>

        <!-- Remarks Table -->
        <h2><strong>REMARKS TABLE</strong></h2>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Site Incharge</th>
                        <th>Remarks</th>
                        <th>Support Required from Customer</th>
                        <th>Customer Action Date</th>
                        <th>Customer Action Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    {% if records %}
                        {% for record in rec | reverse %}
                        <tr>
                            <td {% if loop.index < 8 %}class="highlight-row"{% endif %}>{{ record.date }}</td>
                            <td {% if loop.index < 8 %}class="highlight-row"{% endif %}>{{ record.site }}</td>
                            <td {% if loop.index < 8 %}class="highlight-row"{% endif %}>{{ record.remarks }}</td>
                            <td {% if loop.index < 8 %}class="highlight-row"{% endif %}>{{ record.support }}</td>
                            <td {% if loop.index < 8 %}class="highlight-row"{% endif %}>{{ record.support1 }}</td>
                            <td class="{% if record.sdate == 'no action' %}status-not-approved{% elif record.sdate == 'partially completed' %}status-pending{% else %}status-done{% endif %}">{{ record.sdate }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" style="text-align: center; font-style: italic;">No records found.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Footer -->
        <h6>For any queries Contact:</h6>
        <div class="footer">
            <div class="left">
                <div class="contact-info">
                    <p><strong>PROJECT INCHARGE</strong></p>
                    <p>{{contact.name1}}</p>
                    <p><i class="fa fa-envelope"></i> <a href="mailto:{{contact.email1}}">{{contact.email1}}</a></p>
                    <p><i class="fa fa-phone"></i> {{contact.contact1}}</p>
                </div>
            </div>
            <div class="right">
                <div class="contact-info">
                    <p><strong>ESCALATION MANAGER</strong></p>
                    <p>{{contact.name2}}</p>
                    <p><i class="fa fa-envelope"></i> <a href="mailto:{{contact.email2}}">{{contact.email2}}</a></p>
                    <p><i class="fa fa-phone"></i> {{contact.contact2}}</p>
                </div>
            </div>
        </div>

        <div class="lines">
            <div class="line line1"></div>
            <div class="line line2"></div>
            <div class="line line3"></div>
        </div>

        <div class="footer-bottom">
            <p>#372/A, 2nd Floor, New No. 7, 50ft Main Road, Banashankari 1st Stage, Bangalore – 560019 Ph: 080 26628080 | Web: www.nadiya.in</p>
            <p><strong>GST: 29AAECN7940D1ZC | CIN: U74900KA2014PTC077481</strong></p>
        </div>
    </div>

    <script>
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fa fa-moon-o';
                themeText.textContent = 'Dark';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fa fa-sun-o';
                themeText.textContent = 'Light';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('theme-icon').className = 'fa fa-sun-o';
                document.getElementById('theme-text').textContent = 'Light';
            }
        });

        // PDF generation
         function generatePDF() {
    const themeToggle = document.querySelector('.theme-toggle');
    const printBtn = document.querySelector('.print-btn');

    // Hide controls before printing
    if (themeToggle) themeToggle.style.display = 'none';
    if (printBtn) printBtn.style.display = 'none';

    // Trigger native print dialog
    setTimeout(() => {
        window.print();

        // Restore controls after a short delay
        setTimeout(() => {
            if (themeToggle) themeToggle.style.display = 'flex';
            if (printBtn) printBtn.style.display = 'flex';
        }, 1000); // Enough time for print dialog to show
    }, 100);
}
(function setupPrintThemeSwitch() {
    const mediaQueryList = window.matchMedia('print');
    const themeToggle = document.querySelector('.theme-toggle');
    const printBtn = document.querySelector('.print-btn');
    let originalTheme = document.body.getAttribute('data-theme');

    mediaQueryList.addEventListener('change', function(e) {
        if (e.matches) {
            // BEFORE print
            originalTheme = document.body.getAttribute('data-theme');
            document.body.removeAttribute('data-theme'); // Light mode
            if (themeToggle) themeToggle.style.display = 'none';
            if (printBtn) printBtn.style.display = 'none';
        } else {
            // AFTER print
            if (originalTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
            }
            if (themeToggle) themeToggle.style.display = 'flex';
            if (printBtn) printBtn.style.display = 'flex';
        }
    });
})();
    </script>
</body>
</html>
